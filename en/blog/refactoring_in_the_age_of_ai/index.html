<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" href="/favicon.png"><meta name="generator" content="Astro v5.16.11"><!-- Canonical URL --><link rel="canonical" href="https://tech-lessons.in/en/blog/refactoring_in_the_age_of_ai/"><!-- Primary Meta Tags --><title>Refactoring in the age of AI</title><meta name="title" content="Refactoring in the age of AI"><meta name="description" content="Refactoring in the age of AI"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://tech-lessons.in/en/blog/refactoring_in_the_age_of_ai/"><meta property="og:title" content="Refactoring in the age of AI"><meta property="og:description" content="Refactoring in the age of AI"><meta property="og:image" content="https://tech-lessons.in/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://tech-lessons.in/en/blog/refactoring_in_the_age_of_ai/"><meta property="twitter:title" content="Refactoring in the age of AI"><meta property="twitter:description" content="Refactoring in the age of AI"><meta property="twitter:image" content="https://tech-lessons.in/blog-placeholder-1.jpg"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-9KKTKFQ2CM"></script><script>
	window.dataLayer = window.dataLayer || [];
	function gtag() {
		dataLayer.push(arguments);
	}
	gtag("js", new Date());

	gtag("config", "G-9KKTKFQ2CM");
</script><link rel="stylesheet" href="/_astro/about.Dq19AYy-.css"></head> <body class="bg-white text-zinc-900 min-h-screen flex flex-col md:flex-row selection:bg-black selection:text-white"> <header class="md:hidden sticky top-0 z-50 bg-slate-900 border-b border-slate-800 text-white"> <div class="flex items-center justify-between px-6 py-4"> <div class="flex items-center gap-3"> <div class="w-8 h-8 rounded-full border border-slate-700 overflow-hidden bg-slate-800"> <img src="/avatar.png" alt="Sarthak Makhija" class="w-full h-full object-contain"> </div> <div class="flex flex-col"> <span class="font-bold text-sm leading-none">Sarthak Makhija</span> <span class="text-[10px] text-slate-400 mt-0.5">Databases & Storage Systems</span> </div> </div> <button id="mobile-menu-btn" class="p-2 text-slate-300 hover:text-white" aria-label="Toggle menu"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <line x1="3" y1="12" x2="21" y2="12"></line> <line x1="3" y1="6" x2="21" y2="6"></line> <line x1="3" y1="18" x2="21" y2="18"></line> </svg> </button> </div> <!-- Mobile Menu Overlay --> <div id="mobile-menu" class="fixed inset-0 bg-slate-900 z-50 transform translate-x-full transition-transform duration-300 ease-in-out flex flex-col h-screen overflow-y-auto"> <div class="flex items-center justify-between px-6 py-4 border-b border-slate-800"> <div class="flex items-center gap-3"> <div class="w-8 h-8 rounded-full border border-slate-700 overflow-hidden bg-slate-800"> <img src="/avatar.png" alt="Sarthak Makhija" class="w-full h-full object-contain"> </div> <div class="flex flex-col"> <span class="font-bold text-sm leading-none">Sarthak Makhija</span> <span class="text-[10px] text-slate-400 mt-0.5">Databases & Storage Systems</span> </div> </div> <button id="close-menu-btn" class="p-2 text-slate-300 hover:text-white" aria-label="Close menu"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg> </button> </div> <nav class="flex flex-col p-6 gap-2"> <a href="/" class="flex items-center gap-3 px-3 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all font-medium text-lg"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
Home
</a> <a href="/en/paper-notes" class="flex items-center gap-3 px-3 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all font-medium text-lg"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"> <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path> <polyline points="14 2 14 8 20 8"></polyline> <line x1="16" y1="13" x2="8" y2="13"></line> <line x1="16" y1="17" x2="8" y2="17"></line> <polyline points="10 9 9 9 8 9"></polyline> </svg>
Paper Notes
</a> <a href="/top-essays" class="flex items-center gap-3 px-3 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all font-medium text-lg"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
Top Essays
</a> <a href="/tags" class="flex items-center gap-3 px-3 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all font-medium text-lg"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
Tags
</a> <a href="/projects" class="flex items-center gap-3 px-3 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all font-medium text-lg"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
Projects
</a> <a href="/workshops" class="flex items-center gap-3 px-3 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all font-medium text-lg"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
Workshops
</a> <a href="/about" class="flex items-center gap-3 px-3 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all font-medium text-lg"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>
About Me
</a> </nav> <div class="mt-auto p-6 border-t border-slate-800"> <span class="text-xs font-semibold text-slate-500 uppercase tracking-wider pl-3 block mb-4">Contact</span> <div class="flex flex-col gap-2"> <a href="https://github.com/SarthakMakhija" target="_blank" class="flex items-center gap-3 px-3 py-2 text-slate-500 hover:text-white transition-colors"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2.67-5-2.67"></path></svg>
GitHub
</a> <a href="https://www.linkedin.com/in/sarthak-makhija-7a165a55/" target="_blank" class="flex items-center gap-3 px-3 py-2 text-slate-500 hover:text-white transition-colors"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg>
LinkedIn
</a> <a href="https://x.com/MakhijaSarthak" target="_blank" class="flex items-center gap-3 px-3 py-2 text-slate-500 hover:text-white transition-colors"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-12.7 12.5S.7 7 2.8 5.7c-2 2 .5 5.5.5 5.5s-.8-3-3-3l6-6s-1.3 2.5-1.5 3c-1.3-4 5-6 6-5 2.5 0 5 4 5 4Z"></path></svg>
Twitter
</a> </div> </div> </div> </header> <script type="module">const t=document.getElementById("mobile-menu-btn"),n=document.getElementById("close-menu-btn"),e=document.getElementById("mobile-menu");t&&n&&e&&(t.addEventListener("click",()=>{e.classList.remove("translate-x-full")}),n.addEventListener("click",()=>{e.classList.add("translate-x-full")}),e.querySelectorAll("a").forEach(l=>{l.addEventListener("click",()=>{e.classList.add("translate-x-full")})}));</script> <aside class="hidden md:flex flex-col w-[280px] h-screen sticky top-0 border-r border-slate-800 bg-slate-900 p-8 shrink-0"> <!-- Profile --> <div class="flex flex-col items-start mb-12"> <div class="w-16 h-16 rounded-full border-2 border-slate-700 shadow-sm overflow-hidden mb-4 relative bg-slate-800"> <img src="/avatar.png" alt="Sarthak Makhija" class="w-full h-full object-contain"> </div> <h2 class="font-bold text-lg text-white leading-tight">
Sarthak Makhija
</h2> <span class="text-sm text-zinc-400">Databases & Storage Systems</span> </div> <!-- Navigation --> <nav class="flex-1 flex flex-col gap-1"> <a href="/" class="flex items-center gap-3 px-3 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all group font-medium"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
Home
</a> <a href="/en/paper-notes" class="flex items-center gap-3 px-3 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all group font-medium"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity"> <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path> <polyline points="14 2 14 8 20 8"></polyline> <line x1="16" y1="13" x2="8" y2="13"></line> <line x1="16" y1="17" x2="8" y2="17"></line> <polyline points="10 9 9 9 8 9"></polyline> </svg>
Paper Notes
</a> <a href="/top-essays" class="flex items-center gap-3 px-3 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all group font-medium"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity"> <line x1="12" y1="20" x2="12" y2="10"></line> <line x1="18" y1="20" x2="18" y2="4"></line> <line x1="6" y1="20" x2="6" y2="16"></line> </svg>
Top Essays
</a> <a href="/tags" class="flex items-center gap-3 px-3 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all group font-medium"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
Tags
</a> <a href="/projects" class="flex items-center gap-3 px-3 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all group font-medium"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
Projects
</a> <a href="/workshops" class="flex items-center gap-3 px-3 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all group font-medium"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
Workshops
</a> <a href="/about" class="flex items-center gap-3 px-3 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-md transition-all group font-medium"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70 group-hover:opacity-100 transition-opacity"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>
About Me
</a> </nav> <!-- Socials --> <div class="mt-auto pt-8 border-t border-slate-800 flex flex-col gap-4"> <span class="text-xs font-semibold text-slate-500 uppercase tracking-wider pl-3">Contact</span> <div class="flex flex-col gap-1"> <a href="https://github.com/SarthakMakhija" target="_blank" class="flex items-center gap-3 px-3 py-2 text-slate-500 hover:text-white transition-colors text-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2.67-5-2.67"></path></svg>
GitHub
</a> <a href="https://www.linkedin.com/in/sarthak-makhija-7a165a55/" target="_blank" class="flex items-center gap-3 px-3 py-2 text-slate-500 hover:text-white transition-colors text-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg>
LinkedIn
</a> <a href="https://x.com/MakhijaSarthak" target="_blank" class="flex items-center gap-3 px-3 py-2 text-slate-500 hover:text-white transition-colors text-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-12.7 12.5S.7 7 2.8 5.7c-2 2 .5 5.5.5 5.5s-.8-3-3-3l6-6s-1.3 2.5-1.5 3c-1.3-4 5-6 6-5 2.5 0 5 4 5 4Z"></path></svg>
Twitter
</a> </div> </div> </aside> <div class="flex-1 flex flex-col min-w-0"> <main class="flex-1 max-w-[1280px] mx-auto px-6 py-12 md:py-20 w-full">  <article class="max-w-[1280px] mx-auto min-w-0"> <div class="lg:grid lg:grid-cols-[1fr_240px] lg:gap-12 items-start"> <div class="min-w-0"> <!-- Article Header --> <header class="mb-12"> <h1 class="text-[40px] md:text-[48px] font-sans font-extrabold text-black leading-[1.2] mb-6 tracking-tight"> Refactoring in the age of AI </h1> <div class="flex items-center gap-4 text-[16px] text-zinc-500 mb-8 border-b border-zinc-100 pb-8"> <time datetime="2026-02-01T00:00:00.000Z" class="text-zinc-400"> Feb 1, 2026 </time> <span>/</span> <span>Refactoring, AI, Clean Code</span> </div> <div class="w-full mb-12"> <img width="1020" height="510" src="/refactoring-in-the-age-of-ai.webp" alt="" class="w-full rounded-md shadow-sm"> <p class="text-left text-zinc-500 italic mt-3 text-sm"> Image by Gemini </p> </div> </header> <!-- Table of Contents (Mobile Only) --> <div class="lg:hidden bg-gray-50 rounded-lg p-6 mb-12 border border-zinc-100"> <h2 class="text-black font-bold font-sans text-[16px] uppercase tracking-wide mb-4">
Table of contents
</h2> <ul class="space-y-2 list-none m-0 p-0 text-zinc-600"> <li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#introduction" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Introduction </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#the-example" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> The Example </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#characterization-tests" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Characterization Tests </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#extract-method-amount" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Extract Method (Amount) </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#move-method" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Move Method </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#replace-temp-with-query" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Replace Temp with Query </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#encapsulate-collection" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Encapsulate Collection </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#extract-method-header-body-footer" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Extract Method (Header, Body, Footer) </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#extract-class-textstatement" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Extract Class (TextStatement) </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#moving-tests-and-cleanup" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Moving Tests and Cleanup </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#summary" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Summary </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#mention" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Mention </a> </li> </ul> </div> <!-- Article Content --> <div class="prose prose-lg max-w-none text-black
            [&_h1]:font-serif [&_h1]:font-bold [&_h1]:text-black [&_h1]:text-[36px] [&_h1]:mt-10 [&_h1]:mb-4
            [&_h2]:font-serif [&_h2]:font-bold [&_h2]:text-black [&_h2]:text-[30px] [&_h2]:mt-10 [&_h2]:mb-6
            [&_h3]:font-sans [&_h3]:font-bold [&_h3]:text-black [&_h3]:text-[24px] [&_h3]:mt-10 [&_h3]:mb-4
            [&_h4]:font-sans [&_h4]:font-bold [&_h4]:text-black [&_h4]:text-[18px] [&_h4]:mt-8 [&_h4]:mb-4
            [&_p]:font-sans [&_p]:text-[1.125rem] [&_p]:leading-[1.7777778] [&_p]:text-zinc-800 [&_p]:my-[1em]
            [&_a]:underline [&_a]:decoration-zinc-400 [&_a]:transition-all
            
            /* Table Styling */
            [&_table]:w-full [&_table]:border-collapse [&_table]:my-8 [&_table]:border [&_table]:border-zinc-200 [&_table]:rounded-lg [&_table]:overflow-hidden
            [&_th]:text-left [&_th]:p-3 [&_th]:border-b [&_th]:border-zinc-200 [&_th]:bg-zinc-50 [&_th]:font-semibold [&_th]:text-zinc-900
            [&_td]:p-3 [&_td]:border-b [&_td]:border-zinc-200 [&_td]:text-zinc-700
            [&_tr:last-child_td]:border-0
            
            [&_li]:text-[1.125rem] [&_li]:leading-[1.7777778] [&_li]:text-zinc-800 [&_li]:mb-2
            [&_ol]:list-decimal [&_ol]:pl-6 [&_ol]:mb-6
            [&_ul]:list-disc [&_ul]:pl-6 [&_ul]:mb-6
            [&_img]:rounded-md [&_img]:shadow-lg [&_img]:my-8
            [&_figcaption]:text-center [&_figcaption]:text-sm [&_figcaption]:text-zinc-500 [&_figcaption]:italic [&_figcaption]:mt-[-20px] [&_figcaption]:mb-8
            [&_blockquote]:relative [&_blockquote]:bg-zinc-100 [&_blockquote]:text-zinc-700 [&_blockquote]:p-8 [&_blockquote]:rounded-2xl [&_blockquote]:my-10 [&_blockquote]:not-italic [&_blockquote]:text-[1.1rem] [&_blockquote]:leading-relaxed [&_blockquote]:ml-24
            [&_blockquote::before]:content-[''] [&_blockquote::before]:absolute [&_blockquote::before]:top-8 [&_blockquote::before]:-left-3 [&_blockquote::before]:border-t-[12px] [&_blockquote::before]:border-t-transparent [&_blockquote::before]:border-b-[12px] [&_blockquote::before]:border-b-transparent [&_blockquote::before]:border-r-[16px] [&_blockquote::before]:border-r-zinc-100
            [&_blockquote::after]:content-[''] [&_blockquote::after]:absolute [&_blockquote::after]:-left-32 [&_blockquote::after]:-top-2 [&_blockquote::after]:w-28 [&_blockquote::after]:h-28 [&_blockquote::after]:bg-[url('/avatar.png')] [&_blockquote::after]:bg-contain [&_blockquote::after]:bg-no-repeat [&_blockquote::after]:bg-center [&_blockquote::after]:rounded-full [&_blockquote::after]:border-4 [&_blockquote::after]:border-white [&_blockquote::after]:shadow-md
            [&_pre]:p-6 [&_pre]:rounded-lg [&_pre]:overflow-x-auto [&_pre]:my-8
            [&_code]:font-mono [&_code]:text-[14px] [&_code]:leading-relaxed"> <h3 id="introduction">Introduction</h3>
<p>In the era of Generative AI, we often obsess over velocity, how fast can Copilot write this function? How quickly can Antigravity build this app? But speed is just the baseline; the true “magic” of AI lies in its ability to elevate software quality to levels that were previously painstaking to achieve. AI isn’t a replacement for engineering craftsmanship; it is an amplifier. To use this effectively, you still need to be the driver, the navigator, and above all, the architect who recognizes code smells. You need to identify <strong>Primitive Obsession</strong> before you can ask an agent to fix it; you need to spot a <strong>Long Method</strong> before you can guide an LLM to extract it.</p>
<p>In this article, we’ll revisit a classic refactoring example, not to merely clean it up, but to demonstrate how deep knowledge of refactoring principles combined with AI agents can deliver next-level software quality. We will start where every safe refactoring journey begins: with <a href="/en/blog/lets_define_legacy_code/#which-tests-to-write">characterization tests</a>.</p>
<h3 id="the-example">The Example</h3>
<p>Let’s look at a familiar piece of code (adapted from Martin Fowler’s Refactoring book). It calculates rental charges for a video store.</p>
<p>The code below belongs to a hypothetical “Movie Rental” application that allows customers to rent either Regular or Children’s movies for a specified number of days. The application also generates a statement, which the business calls a “Text Statement.” This system has been running in production for a long time without issues and has grown quite popular. Now, the business wants to generate an “HTML statement” to improve the customer experience, but crucially, they want to do this without altering the underlying logic for amount computation.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> java.util.ArrayList;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String name;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">Rental</span><span style="color:#E1E4E8">> rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> ArrayList&#x3C;>();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> name;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> addRental</span><span style="color:#E1E4E8">(Rental </span><span style="color:#FFAB70">arg</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(arg);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">getName</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> name;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> totalAmount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental each </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">            double</span><span style="color:#E1E4E8"> thisAmount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">            //determine the amounts for each line</span></span>
<span class="line"><span style="color:#F97583">            switch</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getPriceCode</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#F97583">                case</span><span style="color:#E1E4E8"> Movie.REGULAR</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                    thisAmount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                    if</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                        thisAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                    break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                case</span><span style="color:#E1E4E8"> Movie.CHILDRENS</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                    thisAmount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                    if</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                        thisAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                    break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#6A737D">            //show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> each.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(thisAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            totalAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> thisAmount;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#6A737D">        //add footer lines result</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(totalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#F97583"> final</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> CHILDRENS </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#F97583"> final</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> REGULAR </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String title;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> priceCode;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">title</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> priceCode</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.title </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> title;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.priceCode </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> priceCode;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> title;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> getPriceCode</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> priceCode;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> daysRented;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> Movie movie;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(Movie </span><span style="color:#FFAB70">movie</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> daysRented</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.movie </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> movie;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.daysRented </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> daysRented;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> getDaysRented</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> daysRented;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> Movie </span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> movie;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="characterization-tests">Characterization Tests</h3>
<p>Before we even touch a single line of production code, we must ensure we have a safety net. This safety net comes in the form of <strong>Characterization Tests</strong>.</p>
<blockquote>
<p>A Characterization Test is a test that characterizes the actual behavior of a piece of code. It doesn’t check for “correct” behavior but rather records what the code <em>currently does</em>.</p>
</blockquote>
<p>Why do we need this? Because refactoring, by definition, means changing the structure of code without changing its behavior. If we don’t know exactly what the code does right now (bugs and all), we can’t guarantee we haven’t broken it.</p>
<p>For our <code>Customer</code> class, we want to capture the exact output of the <code>statement()</code> method for various scenarios. We can ask our AI agent to generate these tests for us.</p>
<p><strong>Prompt to AI:</strong>
Write Characterization Tests for the <code>statement()</code> method covering all branches.</p>
<p><strong>Generated Test:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> characterizationTest</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    Customer customer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Regular Movie Branches</span></span>
<span class="line"><span style="color:#6A737D">    // Line 27: if (days &#x3C; 2)</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 1 Day"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)); </span><span style="color:#6A737D">// Branch: Regular &#x3C; 2</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 2 Days"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)); </span><span style="color:#6A737D">// Branch: Regular == 2</span></span>
<span class="line"><span style="color:#6A737D">                                                                                    // (Boundary)</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 3 Days"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)); </span><span style="color:#6A737D">// Branch: Regular > 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Children's Movie Branches</span></span>
<span class="line"><span style="color:#6A737D">    // Line 32: if (days &#x3C; 3)</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 1 Day"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)); </span><span style="color:#6A737D">// Branch: Childrens &#x3C; 3</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 3 Days"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)); </span><span style="color:#6A737D">// Branch: Childrens == 3</span></span>
<span class="line"><span style="color:#6A737D">                                                                                        // (Boundary)</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 4 Days"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)); </span><span style="color:#6A737D">// Branch: Childrens > 3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Unknown Movie Type Branch (Default case, implicitly does nothing)</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Unknown Type"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Execute statement</span></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customer.</span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 1 Day</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">0.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 2 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 3 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 1 Day</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">-1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 3 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 4 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Unknown Type</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">0.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "Amount owed is 6.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>That did not go well. The AI generated a single test with all branches, however, we want to test each branch separately. Let’s ask the AI to generate tests for each branch separately.</p>
<p><strong>Prompt to AI:</strong>
I need separate unit tests for statement method. A test with MovieType = Regular, daysRented &#x3C; 2, another test with MovieType = Regular, daysRented >= 2. Similarly, write tests for Childrens Movie.</p>
<p><strong>Generated Tests:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> statementForRegularMovieRentedForLessThanTwoDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    Customer customer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 1 Day"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customer.</span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 1 Day</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">0.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "Amount owed is 0.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> statementForRegularMovieRentedForTwoOrMoreDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    Customer customer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 3 Days"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customer.</span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 3 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "Amount owed is 2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> statementForChildrensMovieRentedForLessThanThreeDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    Customer customer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 1 Day"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customer.</span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 1 Day</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">-1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "Amount owed is -1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> statementForChildrensMovieRentedForThreeOrMoreDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    Customer customer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 4 Days"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customer.</span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 4 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "Amount owed is 1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>This is much better. However, I want to add one more characterization test covering multiple rentals for a customer. This gives me confidence that the system correctly handles multiple entries, allowing me to refactor without worry. It is a judgment call to ensure I have a wide enough safety net.</p>
<p><strong>Prompt to AI:</strong>
Add another characterization test with rentals for childres and regular movie types.</p>
<p><strong>Generated Test:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> statementForRegularAndChildrensMovies</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    Customer customer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 1 Day"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#E1E4E8">    customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 4 Days"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customer.</span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 1 Day</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">0.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 4 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">            "Amount owed is 2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Given all the tests are passing, we will make a <em>git commit</em>, push the changes and move on to refactoring the code.</p>
<h3 id="extract-method-amount">Extract Method (Amount)</h3>
<p>We are ready to begin. The <code>statement()</code> method is our first target. While it may not look excessively long in lines of code, it suffers from the <strong>Long Method</strong> smell because it is highly decomposable, and until we break it apart, other smells will remain hidden in the noise.</p>
<p>Since this is our first refactoring move, I want to be explicit. I’ll provide the AI with precise, step-by-step instructions to minimize ambiguity. As we build momentum and trust, I’ll experiment with leaner prompts.</p>
<p><strong>Prompt to AI:</strong>
Let’s refactor the <code>statement()</code> method. It is a long method, and I would like to extract the rental calculation for each <code> movieType</code> in a separate method. The method will be called <code>amount</code> and it will just accept <code>Rental</code> (/<code>each</code>). This method will return a <code>double</code> which will be assigned to <code>thisAmount</code>.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    double</span><span style="color:#E1E4E8"> totalAmount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (Rental each </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">        </span><span style="color:#F97583" class="highlighted-word">double</span><span style="color:#E1E4E8" class="highlighted-word"> thisAmount </span><span style="color:#F97583" class="highlighted-word">=</span><span style="color:#B392F0" class="highlighted-word"> amount</span><span style="color:#E1E4E8" class="highlighted-word">(each);</span><span style="color:#E1E4E8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> each.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(thisAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        totalAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> thisAmount;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    // add footer lines result</span></span>
<span class="line"><span style="color:#E1E4E8">    result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(totalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">(Rental each) {</span></span>
<span class="line"><span style="color:#F97583">    double</span><span style="color:#E1E4E8"> thisAmount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    switch</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getPriceCode</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#E1E4E8"> Movie.REGULAR</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">            thisAmount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                thisAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#E1E4E8"> Movie.CHILDRENS</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">            thisAmount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                thisAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (each.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> thisAmount;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Excellent! We can run all the tests and create a <em>git commit</em>. Now is the perfect time for some quick refactorings, such as renaming <code>each</code> to <code>rental</code> and <code>thisAmount</code> to <code>amount</code>. Here is the code resulting from these quick wins:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    double</span><span style="color:#E1E4E8"> totalAmount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> rentalAmount </span><span style="color:#F97583">=</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">(rental);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(rentalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        totalAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> rentalAmount;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    // add footer lines result</span></span>
<span class="line"><span style="color:#E1E4E8">    result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(totalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">(Rental rental) {</span></span>
<span class="line"><span style="color:#F97583">    double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    switch</span><span style="color:#E1E4E8"> (rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getPriceCode</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#E1E4E8"> Movie.REGULAR</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">            amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (rental.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (rental.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#E1E4E8"> Movie.CHILDRENS</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">            amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (rental.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (rental.</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> amount;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>We can run all the tests and record our progress with a <em>git commit</em>.</p>
<h3 id="move-method">Move Method</h3>
<p>A close examination of the <code>amount()</code> method reveals that it relies solely on the <code>Rental</code> object. This suggests the method is a better fit for the <code>Rental</code> class. Before we move it, we can add the <code>static</code> keyword to confirm that the method does not use any properties of the <code>Customer</code> class.</p>
<p>Run all the tests after adding <code>static</code> keyword, they pass. It confirms we have <strong>Feature Envy</strong> and we can move the <code>amount()</code> method to the <code>Rental</code> class (remove the <code>static</code> qualifier before moving).</p>
<p><strong>Prompt to AI:</strong>
Move the <code>amount()</code> method to the <code>Rental</code> class.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> totalAmount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">            </span><span style="color:#F97583" class="highlighted-word">double</span><span style="color:#E1E4E8" class="highlighted-word"> rentalAmount </span><span style="color:#F97583" class="highlighted-word">=</span><span style="color:#E1E4E8" class="highlighted-word"> rental.</span><span style="color:#B392F0" class="highlighted-word">getAmount</span><span style="color:#E1E4E8" class="highlighted-word">();</span><span style="color:#E1E4E8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">            // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(rentalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            totalAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> rentalAmount;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#6A737D">        // add footer lines result</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(totalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> getAmount</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        switch</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getPriceCode</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#E1E4E8"> Movie.REGULAR</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#E1E4E8"> Movie.CHILDRENS</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">getDaysRented</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Good job! I’ll start by renaming <code>getAmount</code> to <code>amount</code>. Since all our tests are passing, I’ll perform one more refactoring step before committing. The <code>amount</code> method currently depends on both the <code>priceCode</code> from the <code>Movie</code> class and <code>daysRented</code> from the <code>Rental</code> class. Since the amount calculation logic is primarily driven by the <code>priceCode</code>, it makes sense to move this method to the <code>Movie</code> class and pass <code>daysRented</code> as an argument. This move also encapsulates the <code>priceCode</code> switch case within the <code>Movie</code> class, preventing it from leaking <em>switch</em> logic into other classes.</p>
<p><strong>Prompt to AI:</strong>
Move the <code>amount()</code> method to the <code>Movie</code> class passing <code>daysRented</code> as argument.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        </span><span style="color:#F97583" class="highlighted-word">return</span><span style="color:#E1E4E8" class="highlighted-word"> movie.</span><span style="color:#B392F0" class="highlighted-word">amount</span><span style="color:#E1E4E8" class="highlighted-word">(daysRented);</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> daysRented</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        switch</span><span style="color:#E1E4E8"> (priceCode) {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#E1E4E8"> REGULAR</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#E1E4E8"> CHILDRENS</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> amount;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Nice, and all our tests are running. This refactoring also gives us an opportunity to add unit tests for <code>Movie</code> and <code>Rental</code>. Let’s ask AI to add unit tests for both these objects.</p>
<p><strong>Prompt to AI:</strong>
Add unit tests for Movie, cover all branches. Ensure separate test cases.</p>
<p><strong>Generated Tests:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> MovieTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> amountForRegularMovieRentedForLessThanTwoDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Movie movie </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular"</span><span style="color:#E1E4E8">, Movie.REGULAR);</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> movie.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">, amount);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> amountForRegularMovieRentedForTwoDaysOrMore</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Movie movie </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular"</span><span style="color:#E1E4E8">, Movie.REGULAR);</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> movie.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2.0</span><span style="color:#E1E4E8">, amount);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> amountForChildrensMovieRentedForLessThanThreeDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Movie movie </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children"</span><span style="color:#E1E4E8">, Movie.CHILDRENS);</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> movie.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.0</span><span style="color:#E1E4E8">, amount);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> amountForChildrensMovieRentedForThreeDaysOrMore</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Movie movie </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children"</span><span style="color:#E1E4E8">, Movie.CHILDRENS);</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> movie.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1.5</span><span style="color:#E1E4E8">, amount);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Excellent. We could apply the same process for <code>Rental</code>. However, <code>Rental</code>’s <code>amount()</code> method is now just a wrapper that delegates to <code>Movie</code>, making the need for separate tests debatable. We have made decent progress; <code>Rental</code> and <code>Movie</code> are no longer just data classes, they now encapsulate behavior alongside their data. All are tests are passing, let’s record this refactoring as a <em>git commit</em>.</p>
<h3 id="replace-temp-with-query">Replace Temp with Query</h3>
<p>This is how our code looks like:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> totalAmount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">            double</span><span style="color:#E1E4E8"> rentalAmount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">            // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(rentalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">            totalAmount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> rentalAmount;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#6A737D">        // add footer lines result</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(totalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> daysRented</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        switch</span><span style="color:#E1E4E8"> (priceCode) {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#E1E4E8"> REGULAR</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#E1E4E8"> CHILDRENS</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> amount;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> movie.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">(daysRented);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>What’s the next move? The <code>switch</code> statement in <code>Movie.amount()</code> may look like a candidate for polymorphism, but I want to ensure we’ve truly achieved our primary goal: decomposing the <code>statement()</code> method before moving on to other refactoring.</p>
<p>I would argue the method is still ‘long’ - not in terms of line count, but in terms of responsibility. I can clearly distinguish three separate phases within it: generating the header, processing the body, and assembling the footer.</p>
<p>Before we move forward with the refactoring of <code>statement</code> methods, let’s have a conversation with AI and see if it has any suggestions for us.</p>
<p><strong>Prompt to AI:</strong>
Provide me potential candidates for next refactoring. Do not change anything.</p>
<p><strong>Generated Response:</strong></p>
<ol>
<li>Move Classes to Separate Files</li>
<li><strong>Replace Conditional with Polymorphism</strong> (in <code>Movie</code>)</li>
<li><strong>Replace Temp with Query</strong> (in <code>statement()</code>)
<ul>
<li>Context: The <code>statement</code> method calculates <code>totalAmount</code> while generating the string.</li>
<li>Value: Extracting the calculation into a method (e.g., <code>getTotalCharge</code>) separates the business logic from the presentation logic, making it easier to support other formats like HTML statements.</li>
</ul>
</li>
</ol>
<p>Suggestion 3 is appealing, even impressive, the AI suggested supporting HTML statements without any prompting from me. However, this is exactly where we must exercise discipline. Adhering to the <strong>YAGNI</strong> (‘You Aren’t Gonna Need It’) principle, we must not refactor based on speculation. No matter how clever the AI’s prediction is, if the requirement doesn’t exist today, we shouldn’t build the complexity to support it.</p>
<p>However, AI is right in pointing out that we can refactor the <code>statement</code> method to separate the business logic from the presentation logic by applying the <strong>Replace Temp with Query</strong> refactoring. Let’s try asking the AI to provide us with a refactored version of the <code>statement</code> method.</p>
<p><strong>Prompt to AI:</strong>
Implement Replace Temp with Query (in Customer.statement)</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> rentalAmount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(rentalAmount) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    // add footer lines result</span></span>
<span class="line"><span style="color:#E1E4E8">    result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> String.</span><span style="color:#B392F0">valueOf</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0" class="highlighted-word">getTotalCharge</span><span style="color:#E1E4E8" class="highlighted-word">()</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">; </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> </span><span style="color:#B392F0" class="highlighted-word">getTotalCharge</span><span style="color:#E1E4E8" class="highlighted-word">()</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    double</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>This looks much cleaner, and our tests are green. Let’s commit this and rename <code>getTotalCharge</code> to <code>totalCharge</code>. The <code>statement</code> method now clearly reveals its structure: header, body, and footer.</p>
<blockquote>
<p>You might notice we are now iterating over <code>rentals</code> twice. While some might worry about performance, it’s crucial not to optimize prematurely. Our priorities are correctness first, clarity second, and performance third. If profiling later shows <code>statement()</code> is a bottleneck, we can optimize it then, but for now, readability wins.</p>
</blockquote>
<p>If you have a keen eye for code smells, you might notice that <code>totalCharge</code> depends exclusively on the <code>rentals</code> collection. To verify this, let’s pass <code>rentals</code> as a parameter and make the method <code>static</code>. If our tests pass, it confirms that <code>totalCharge</code> is a pure function of its input. This reveals a classic case of <strong>Feature Envy</strong>: the method is more interested in the <code>rentals</code> data than the <code>Customer</code> class it resides in, suggesting it belongs in a dedicated <code>Rentals</code> class.</p>
<p>Additionally, there’s another subtle smell here: <strong>Primitive Obsession</strong> regarding <code>List&#x3C;Rental></code>. While a <code>List</code> isn’t a primitive type in Java, using a generic collection to represent a domain concept (a collection of customer rentals) is the same mistake. It’s just a raw container. By upgrading this to a first-class <code>Rentals</code> object, we create a proper home for behavior like <code>totalCharge</code> that belongs to the collection, not the client (<code>Customer</code>) using it.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#6A737D">//this method depends only on rentals collection.</span></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> totalCharge</span><span style="color:#E1E4E8">(List</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">Rental</span><span style="color:#F97583">></span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">    double</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="encapsulate-collection">Encapsulate Collection</h3>
<p>It’s time to introduce a first-class collection. We’ll create a <code>Rentals</code> class to manage the list of rentals. To maintain backward compatibility and minimize initial breakage, <code>Rentals</code> will extend <code>ArrayList&#x3C;Rental></code> for now.</p>
<p>Let’s ask AI to introduce <code>Rentals</code>.</p>
<p><strong>Prompt to AI:</strong>
Introduce <code>Rentals</code> class. Extend it from ArrayList<rental>, and move <code>totalCharge</code> to <code>Rentals</code>.</rental></p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String name;</span></span>
<span class="line"><span style="color:#F97583">    </span><span style="color:#F97583" class="highlighted-word">private</span><span style="color:#E1E4E8" class="highlighted-word"> Rentals rentals </span><span style="color:#F97583" class="highlighted-word">=</span><span style="color:#F97583" class="highlighted-word"> new</span><span style="color:#B392F0" class="highlighted-word"> Rentals</span><span style="color:#E1E4E8" class="highlighted-word">();</span><span style="color:#E1E4E8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">            double</span><span style="color:#E1E4E8"> rentalAmount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">            // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    rentalAmount </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#6A737D">        // add footer lines result</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> </span><span style="color:#E1E4E8" class="highlighted-word">rentals.</span><span style="color:#B392F0" class="highlighted-word">totalCharge</span><span style="color:#E1E4E8" class="highlighted-word">()</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">; </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rentals</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> ArrayList</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#F97583">Rental</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> totalCharge</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>It looks good, and all the tests are running. We can now as AI to add tests for <code>Rentals</code> covering all scenarios: no rental, a single rental and multiple rentals.</p>
<p><strong>Prompt to AI:</strong>
Write unit tests for <code>Rentals</code>, cover all scenarios: no rental, a single rental and multiple rentals. Ensure separate unit tests for all scenarios.</p>
<p><strong>Generated Tests:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> RentalsTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> totalChargeForNoRentals</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.0</span><span style="color:#E1E4E8">, rentals.</span><span style="color:#B392F0">totalCharge</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> totalChargeForSingleRental</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">, rentals.</span><span style="color:#B392F0">totalCharge</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> totalChargeForMultipleRentals</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2.0</span><span style="color:#E1E4E8">, rentals.</span><span style="color:#B392F0">totalCharge</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>The tests looks good, and all the tests are running. Let’s create a <em>git commit</em>.</p>
<h3 id="extract-method-header-body-footer">Extract Method (Header, Body, Footer)</h3>
<p>This is how our <code>statement()</code> method looks like:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> rentalAmount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                rentalAmount </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    // add footer lines result</span></span>
<span class="line"><span style="color:#E1E4E8">    result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rentals.</span><span style="color:#B392F0">totalCharge</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>We can now refactor the <code>statement()</code> to be composed of <code>header</code>, <code>body</code> and <code>footer</code>. Let’s ask AI to futher decompose this method.</p>
<p><strong>Prompt to AI:</strong>
Refactor statement method to consist of header, body and footer.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">statement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#B392F0"> header</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#B392F0"> body</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#B392F0"> footer</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">header</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">body</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ""</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#6A737D">        // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">        result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">footer</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rentals.</span><span style="color:#B392F0">totalCharge</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>This look good, AI also removed the comment <strong>// add footer lines result</strong>, which is good because the method name <code>footer()</code> already tells us that it’s adding a footer line. We have made very good progress in refactoring the <code>statement()</code> method. Let’s create a <em>git commit</em> since all our tests are passing.</p>
<p>I can three potential refactoring opportunites:</p>
<ol>
<li>Rename <code>statement()</code> to <code>textStatement()</code>, <code>header</code> to <code>textHeader</code>, <code>body</code> to <code>textBody</code> and <code>footer</code> to <code>textFooter</code>.</li>
<li>Introduce polymorphism in <code>Movie</code> to handle different price codes.</li>
<li>Refactor <code>body</code> method. It depends on properties and behaviors of <code>Movie</code> and <code>Rental</code> classes.</li>
</ol>
<p>I think I will take point 1 first. It is a simple rename operation, and it makes the intent of <code>statement()</code> clearer.</p>
<h3 id="extract-class-textstatement">Extract Class (TextStatement)</h3>
<p>Let’s ask AI to rename statement to <code>textStatement</code> and its child methods <code>header</code>, <code>body</code> and <code>footer</code> to <code>textHeader</code>, <code>textBody</code> and <code>textFooter</code> respectively.</p>
<p><strong>Prompt to AI:</strong>
Rename statement to <code>textStatement</code> and its child methods <code>header</code>, <code>body</code> and <code>footer</code> to <code>textHeader</code>, <code>textBody</code> and <code>textFooter</code> respectively.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textStatement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> textHeader</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#B392F0"> textBody</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#B392F0"> textFooter</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textHeader</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> getName</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textBody</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ""</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#6A737D">            // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textFooter</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rentals.</span><span style="color:#B392F0">totalCharge</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Excellent, all tests pass. Let’s maximize this win with a commit. This refactoring does more than just rename; it reveals a structural pattern. We now have a cluster of methods sharing the <code>text</code> prefix, all operating on the same data. This cohesive group suggests a hidden abstraction, perhaps a <strong>TextStatement</strong> object, waiting to be extracted.</p>
<p>Let’s ask AI to introduce <code>TextStatement</code>.</p>
<p><strong>Prompt to AI:</strong>
Introduce TextStatment class which depends on customer name and rentals.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textStatement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        </span><span style="color:#F97583" class="highlighted-word">return</span><span style="color:#F97583" class="highlighted-word"> new</span><span style="color:#B392F0" class="highlighted-word"> TextStatement</span><span style="color:#E1E4E8" class="highlighted-word">(</span><span style="color:#79B8FF" class="highlighted-word">this</span><span style="color:#E1E4E8" class="highlighted-word">.name, </span><span style="color:#79B8FF" class="highlighted-word">this</span><span style="color:#E1E4E8" class="highlighted-word">.rentals).</span><span style="color:#B392F0" class="highlighted-word">value</span><span style="color:#E1E4E8" class="highlighted-word">();</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String customerName;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> Rentals rentals;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">customerName</span><span style="color:#E1E4E8">, Rentals </span><span style="color:#FFAB70">rentals</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.customerName </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customerName;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.rentals </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> rentals;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">value</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> textHeader</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#B392F0"> textBody</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#B392F0"> textFooter</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textHeader</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> customerName </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textBody</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ""</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#6A737D">            // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textFooter</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rentals.</span><span style="color:#B392F0">totalCharge</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>This is nice. I would like to rename <code>value</code> method of <code>TextStatement</code> to <code>get</code>, <code>textHeader</code>, <code>textBody</code> and <code>textFooter</code> to <code>header</code>, <code>body</code> and <code>footer</code> respectively and add unit tests for this class.</p>
<p><strong>Prompt to AI:</strong>
Rename value to get, textHeader to header, textBody to body and textFooter to footer and add unit tests for TextStatement.</p>
<p><strong>Generated Tests:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> testGetReturnStatement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"New Release"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        TextStatement statement </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">, rentals);</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> statement.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">0.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">New Release</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "Amount owed is 2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>We should definitely rename the test. Notice that <code>Customer.textStatement()</code> has become a simple delegate to <code>TextStatement</code>. This signals that the responsibility has fully shifted. It’s now appropriate to move our original characterization tests from the <code>Customer</code> class to <code>TextStatement</code>, ensuring our tests live alongside the logic they verify.</p>
<p>Let’s ask AI to move the tests from <code>Customer</code> to <code>TextStatement</code>. And maybe we will keep one test in <code>Customer</code> which generates a text statement for multiple rentals.</p>
<p><strong>Prompt to AI:</strong>
Move the tests from <code>Customer</code> to <code>TextStatement</code>. And maybe we will keep one test in <code>Customer</code> which generates a text statement for multiple rentals. Also ensure all the test names do not begin with test and reflect the domain Text statement.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> CustomerTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> textStatementForRegularAndChildrensMovies</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Customer customer </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 1 Day"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#E1E4E8">        customer.</span><span style="color:#B392F0">addRental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 4 Days"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customer.</span><span style="color:#B392F0">textStatement</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 1 Day</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">0.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 4 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "Amount owed is 2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> TextStatementTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> regularMovieRentedForLessThanTwoDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 1 Day"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        TextStatement statement </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">, rentals);</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> statement.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 1 Day</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">0.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "Amount owed is 0.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> regularMovieRentedForTwoOrMoreDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Regular 3 Days"</span><span style="color:#E1E4E8">, Movie.REGULAR), </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        TextStatement statement </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">, rentals);</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> statement.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Regular 3 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "Amount owed is 2.0</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> childrensMovieRentedForLessThanThreeDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 1 Day"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        TextStatement statement </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">, rentals);</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> statement.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 1 Day</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">-1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "Amount owed is -1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> childrensMovieRentedForThreeOrMoreDays</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Children 4 Days"</span><span style="color:#E1E4E8">, Movie.CHILDRENS), </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        TextStatement statement </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"John Doe"</span><span style="color:#E1E4E8">, rentals);</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> statement.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        String expected </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Rental Record for John Doe</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">Children 4 Days</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#9ECBFF">                "Amount owed is 1.5</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(expected, result);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Great, all tests pass. Let’s create a <em>git commit</em>.</p>
<h3 id="moving-tests-and-cleanup">Moving Tests and Cleanup</h3>
<p>This is how our code looks like:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String name;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> Rentals rentals </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Rentals</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> Customer</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> name;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> addRental</span><span style="color:#E1E4E8">(Rental </span><span style="color:#FFAB70">rental</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        rentals.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(rental);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">getName</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> name;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">textStatement</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.name, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.rentals).</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#F97583"> final</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> CHILDRENS </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#F97583"> final</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> REGULAR </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String title;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> priceCode;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> Movie</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">title</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> priceCode</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.title </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> title;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.priceCode </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> priceCode;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> title;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> getPriceCode</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> priceCode;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> daysRented</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> amount </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        switch</span><span style="color:#E1E4E8"> (priceCode) {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#E1E4E8"> REGULAR</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#E1E4E8"> CHILDRENS</span><span style="color:#F97583">:</span></span>
<span class="line"><span style="color:#E1E4E8">                amount </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    amount </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (daysRented </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 1.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">                break</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> amount;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> daysRented;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> Movie movie;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8">(Movie </span><span style="color:#FFAB70">movie</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> daysRented</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.movie </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> movie;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.daysRented </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> daysRented;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> int</span><span style="color:#B392F0"> getDaysRented</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> daysRented;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> Movie </span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> movie;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> amount</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> movie.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">(daysRented);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rentals</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> ArrayList</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#F97583">Rental</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> totalCharge</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        double</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String customerName;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> Rentals rentals;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">customerName</span><span style="color:#E1E4E8">, Rentals </span><span style="color:#FFAB70">rentals</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.customerName </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> customerName;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.rentals </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> rentals;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> header</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#B392F0"> body</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#B392F0"> footer</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">header</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#9ECBFF"> "Rental Record for "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> customerName </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">body</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ""</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#6A737D">            // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rental.</span><span style="color:#B392F0">getMovie</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">footer</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#9ECBFF"> "Amount owed is "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> rentals.</span><span style="color:#B392F0">totalCharge</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>I can still three potential refactoring opportunites:</p>
<ol>
<li><strong>Remove unnecessary getters</strong>. We have encapsulated the code enough to ensure that the internal implementation details are not exposed, which provides us the opportunity to remove some of the getters.</li>
<li><strong>Introduce polymorphism</strong> in <code>Movie</code> to handle different price codes.</li>
<li><strong>Refactor</strong> <code>body</code> method. It depends on properties and behaviors of <code>Movie</code> and <code>Rental</code> classes.</li>
</ol>
<p>Let’s pick the first one and ask AI to remove unnecessary getters. These should be <code>getName</code> from <code>Customer</code>, <code>getPriceCode</code> from <code>Movie</code> and <code>getDaysRented</code> from <code>Rental</code>.</p>
<p><strong>Prompt to AI:</strong>
Remove unnecessary getters.</p>
<p>It removed the getters which we were expecting. Let’s commit this change.</p>
<p>For the scope of this article, I’ll defer the introduction of polymorphism in the <code>Movie</code> class. However, we’ve achieved a significant victory by successfully encapsulating the <code>switch</code> statement within <code>Movie</code>. This means we can swap it for polymorphism in the future with zero impact on <code>Rental</code> or <code>Customer</code>.</p>
<p>Turning our attention to the <code>body</code> method in <code>TextStatement</code>, a few issues immediately jump out at me:</p>
<ol>
<li><strong>Broken Encapsulation</strong>: The chain <code>rental.getMovie().getTitle()</code> is a Law of Demeter violation. <code>TextStatement</code> knows too much about the internal structure of <code>Rental</code> and <code>Movie</code>.</li>
<li><strong>Misplaced Responsibility</strong>: Since we have a <code>Rentals</code> first-class collection, shouldn’t the logic for iterating and formatting the body live there instead?</li>
<li><strong>Hidden Domain Concept</strong>: The comment <code>// show figures for this Rental</code> is intriguing. Is ‘Figure’ just a throwaway word, or does it represent a missing domain object waiting to be discovered?</li>
</ol>
<p>Let me share my thoughts before we have a conversation with AI for these.</p>
<ol>
<li><strong>Encapsulation</strong>: Point 1 is easily solvable. We can follow the Law of Demeter by having <code>Rental</code> expose a <code>movieTitle()</code> method, allowing us to hide the entire <code>Movie</code> object.</li>
<li><strong>Responsibility</strong>: While <code>Rentals</code> manages the collection, it shouldn’t necessarily know how to <em>print</em> itself. Generating the statement format remains the responsibility of <code>TextStatement</code>.</li>
<li><strong>Missing Concept</strong>: ‘Figure’ feels like more than just a comment. It likely represents a concrete domain type, perhaps a tuple combining the <em>Movie title</em> and <em>Amount</em> that we haven’t yet introduced.</li>
</ol>
<p>Let’s have a quick conversation with AI about these points and get its thoughts.</p>
<p><strong>Prompt to AI:</strong>
I have the following concerns about the <code>body</code> method in <code>TextStatement</code> class:</p>
<ol>
<li>It breaks encapsulation <code>rental.getMovie().getTitle()</code>. <code>TextStatement</code> knows that rental has a movie which has a title. This is not good.</li>
<li>We already have an abstraction called <code>Rentals</code>. Does this mean we can move this behavior (<code>body</code>) to <code>Rentals</code> class?</li>
<li>The comment <code>// show figures for this Rental</code> gives me a domain concept called <code>Figure</code>. Is this just a comment or does this domain term <code>Figure</code> mean something more?</li>
</ol>
<p>Share your thoughts, do not change anything.</p>
<p><strong>AI’s Response:</strong></p>
<img src="/refactoring-in-the-age-of-ai-conversation.webp">
<p>Cool. So, we can ask AI to handle these one-by-one. Let’s ask it to encapsulate <code>Movie</code> inside <code>Rental</code>.</p>
<p><strong>Prompt to AI:</strong>
Encapsulate <code>Movie</code> inside <code>Rental</code> and expose <code>movieTitle()</code> method from <code>Rental</code>.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    </span><span style="color:#F97583" class="highlighted-word">public</span><span style="color:#E1E4E8" class="highlighted-word"> String </span><span style="color:#B392F0" class="highlighted-word">movieTitle</span><span style="color:#E1E4E8" class="highlighted-word">() {</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> movie.</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">body</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ""</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#6A737D">            // show figures for this Rental</span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> </span><span style="color:#E1E4E8" class="highlighted-word">rental.</span><span style="color:#B392F0" class="highlighted-word">movieTitle</span><span style="color:#E1E4E8" class="highlighted-word">()</span><span style="color:#E1E4E8"> </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    rental.</span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Excellent. The AI correctly identified that <code>getMovie()</code> was no longer needed and removed it. Let’s lock in this improvement with a commit.</p>
<p>Regarding the <code>body</code> generation, I’ll stick to my decision: <code>TextStatement</code> handles the formatting, not <code>Rentals</code>. However, I can’t shake the feeling that <code>Figure</code> is a missing abstraction. I trust that the original developer’s choice of vocabulary wasn’t accidental. My plan is to have <code>Rentals</code> provide an iterator of <code>Figure</code> objects, which <code>TextStatement</code> can then consume to generate the output. I imagine <code>Figure</code> would be just a <code>data</code> class.</p>
<p>Before I go ahead with this, I would like to see what AI does when I ask it to introduce <code>Figure</code> and refactor the <code>body</code> method.</p>
<p><strong>Prompt to AI:</strong>
Introduce Figure and refactor the body method.</p>
<p><strong>Generated Code:</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Rental</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> Figure </span><span style="color:#B392F0">figure</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Figure</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">movieTitle</span><span style="color:#E1E4E8">(), </span><span style="color:#B392F0">amount</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Figure</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> String title;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#F97583"> double</span><span style="color:#E1E4E8"> amount;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> Figure</span><span style="color:#E1E4E8">(String </span><span style="color:#FFAB70">title</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">double</span><span style="color:#FFAB70"> amount</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.title </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> title;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.amount </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> amount;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> title;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> double</span><span style="color:#B392F0"> getAmount</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> amount;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> TextStatement</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String </span><span style="color:#B392F0">body</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        String result </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ""</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (Rental rental </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> rentals) {</span></span>
<span class="line"><span style="color:#E1E4E8">            </span><span style="color:#E1E4E8" class="highlighted-word">Figure figure </span><span style="color:#F97583" class="highlighted-word">=</span><span style="color:#E1E4E8" class="highlighted-word"> rental.</span><span style="color:#B392F0" class="highlighted-word">figure</span><span style="color:#E1E4E8" class="highlighted-word">();</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">            result </span><span style="color:#F97583">+=</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> figure.</span><span style="color:#B392F0">getTitle</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\t</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> +</span></span>
<span class="line"><span style="color:#E1E4E8">                    figure.</span><span style="color:#B392F0">getAmount</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>I generally avoid data classes, and this implementation gives me pause. <code>Rental</code> now exposes <code>Figure</code>, which simply re-exposes <code>title</code> and <code>amount</code> via getters. It feels like we’re trading one encapsulation leak for another.</p>
<p>That said, giving <code>Figure</code> the responsibility to <em>print</em> itself seems wrong, too especially if <code>HtmlStatement</code> is in the pipeline. For now, I’ll accept <code>Figure</code> as a data carrier to satisfy the current need. On a different day, I might have chosen to revert the method and keep the comment as a breadcrumb, but today, I’ll stick with the explicit type.</p>
<p>Let’s commit this change.</p>
<p>I overlooked that the AI introduced <code>totalCharge</code>, creating a vocabulary clash with our existing <code>amount()</code> method after we moved it to <code>Rentals</code>. We now have two different terms for the same concept. I should have caught this before committing. I will standardize on <code>amount</code> and remove the <code>*charge</code> vocabulary. I won’t bother the AI for this minor cleanup.</p>
<p>Let’s record this as a commit given all our tests are running.</p>
<p>With this, our refactoring of <code>textStatement()</code> is complete. We’ve transformed a monolithic method into a clean, testable design. While I won’t implement <code>htmlStatement()</code> in this article, notice how standardizing on <code>TextStatement</code> paves the way for it.</p>
<p>The final code is available <a href="https://github.com/SarthakMakhija/refactoring-in-the-age-of-ai">here</a>.</p>
<h3 id="summary">Summary</h3>
<p>In the age of AI, the rules of craftsmanship still apply. Here is my manifesto for refactoring with LLMs:</p>
<ul>
<li><strong>Lead the Way</strong>: You don’t always need a final destination, but you must have a direction. Be the driver who evaluates options and sets the course, rather than letting the AI drift aimlessly.</li>
<li><strong>Sharpen Your Senses</strong>: You can’t ask an agent to fix what you can’t see. Your ability to recognize smells is the prerequisite for effective prompting.</li>
<li><strong>Stay Focused</strong>: Build iteratively on your progress. Resist the urge to chase every shiny refactoring opportunity the AI suggests; avoid digressions and finish your current objective first.</li>
<li><strong>Trust but Verify</strong>: AI is a powerful assistant, not a replacement for your judgment. Review every change.</li>
<li><strong>Own the Code</strong>: At the end of the day, you are responsible for the production system, not an AI system.</li>
<li><strong>Speed is Given, Quality is Earned</strong>: AI brings velocity for free. Your job is to channel that energy into raising the bar for software quality.</li>
<li><strong>Small Steps</strong>: Keep your feedback loops tight. Make small, verifying commits to maintain a safety net.</li>
</ul>
<h3 id="mention">Mention</h3>
<p>I would like to thank <a href="https://www.linkedin.com/in/chiragdoshi/">Chirag Doshi</a> for reviewing the article and sparking the idea for this essay during a discussion on teaching refactoring with AI.</p>
<p>I used <a href="https://antigravity.google/">Antigravity</a> with Gemini 3 Pro High.</p> </div> <!-- Tags Section --> <div class="mt-12 pt-8 border-t border-zinc-100"> <div class="flex flex-wrap gap-3"> <div class="flex items-center gap-2 px-3 py-1.5 border border-accent-600 rounded-lg text-accent-600 text-sm font-medium bg-white hover:bg-indigo-50 transition-colors cursor-default"> <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path> <path d="M7 7h.01"></path> </svg> Refactoring </div><div class="flex items-center gap-2 px-3 py-1.5 border border-accent-600 rounded-lg text-accent-600 text-sm font-medium bg-white hover:bg-indigo-50 transition-colors cursor-default"> <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path> <path d="M7 7h.01"></path> </svg> AI </div><div class="flex items-center gap-2 px-3 py-1.5 border border-accent-600 rounded-lg text-accent-600 text-sm font-medium bg-white hover:bg-indigo-50 transition-colors cursor-default"> <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path> <path d="M7 7h.01"></path> </svg> Clean Code </div> </div> </div> <!-- Related Essays --> <div class="mt-12 pt-8 border-t border-zinc-100"> <h2 class="text-2xl font-bold font-sans mb-6 text-black">
More from Tech Lessons
</h2> <div class="grid gap-6 md:grid-cols-2"> <a href="/en/blog/refactoring_mindset/" class="block p-6 rounded-xl border border-zinc-200 hover:border-zinc-300 hover:shadow-sm transition-all bg-white group"> <h3 class="font-sans font-medium text-lg text-zinc-900 mb-2 group-hover:text-accent-600 transition-colors line-clamp-2"> Refactoring Mindset </h3> <div class="text-sm text-zinc-500 font-sans"> <time datetime="2025-01-14T00:00:00.000Z" class="text-zinc-400"> Jan 14, 2025 </time> </div> </a><a href="/en/blog/lets_deal_with_legacy_code/" class="block p-6 rounded-xl border border-zinc-200 hover:border-zinc-300 hover:shadow-sm transition-all bg-white group"> <h3 class="font-sans font-medium text-lg text-zinc-900 mb-2 group-hover:text-accent-600 transition-colors line-clamp-2"> Let’s deal with Legacy code </h3> <div class="text-sm text-zinc-500 font-sans"> <time datetime="2018-04-12T00:00:00.000Z" class="text-zinc-400"> Apr 12, 2018 </time> </div> </a><a href="/en/blog/lets_define_legacy_code/" class="block p-6 rounded-xl border border-zinc-200 hover:border-zinc-300 hover:shadow-sm transition-all bg-white group"> <h3 class="font-sans font-medium text-lg text-zinc-900 mb-2 group-hover:text-accent-600 transition-colors line-clamp-2"> Let&#39;s define Legacy code </h3> <div class="text-sm text-zinc-500 font-sans"> <time datetime="2018-04-10T00:00:00.000Z" class="text-zinc-400"> Apr 10, 2018 </time> </div> </a> </div> </div> <!-- Giscus Comments --> <div class="mt-16 pt-8 border-t border-zinc-100"> <script src="https://giscus.app/client.js" data-repo="SarthakMakhija/tech-lessons-comments" data-repo-id="R_kgDOJHu3mA" data-category="Announcements" data-category-id="DIC_kwDOJHu3mM4CUxhS" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" async></script> </div> </div> <!-- Sidebar TOC (Desktop Only) --> <aside class="hidden lg:block sticky top-24 pt-8 max-h-[calc(100vh-6rem)] overflow-y-auto custom-scrollbar"> <div class="text-xs font-bold text-zinc-400 uppercase tracking-wider mb-4 font-sans">
On this page
</div> <ul class="space-y-2 list-none m-0 p-0 text-zinc-600"> <li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#introduction" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Introduction </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#the-example" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> The Example </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#characterization-tests" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Characterization Tests </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#extract-method-amount" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Extract Method (Amount) </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#move-method" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Move Method </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#replace-temp-with-query" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Replace Temp with Query </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#encapsulate-collection" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Encapsulate Collection </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#extract-method-header-body-footer" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Extract Method (Header, Body, Footer) </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#extract-class-textstatement" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Extract Class (TextStatement) </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#moving-tests-and-cleanup" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Moving Tests and Cleanup </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#summary" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Summary </a> </li><li class="flex gap-3 items-start text-[14px] leading-[21px] ml-3"> <a href="#mention" class="hover:text-accent-600 hover:translate-x-1 transition-all duration-200 ease-in-out"> Mention </a> </li> </ul> </aside> </div> </article>  </main> <footer class="border-t border-slate-800 bg-slate-900 py-8 text-center text-sm text-zinc-500"> <div class="container mx-auto px-4">
tech-lessons.in &copy; 2020 / Powered by <a href="https://astro.build" target="_blank" class="hover:text-zinc-300 transition-colors">Astro</a> </div> </footer> </div> <!-- Subtle gradient glow at the bottom/edges (optional, keeping it really subtle) --> <div class="fixed inset-0 pointer-events-none z-[-1] bg-[radial-gradient(circle_at_50%_120%,rgba(120,119,198,0.1),rgba(255,255,255,0))]"></div> <script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.Ci7t3JeA.js"></script> <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("pre").forEach(t=>{const e=document.createElement("button");e.className="copy-code-button",e.innerHTML=`
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
							<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
						</svg>
					`,e.ariaLabel="Copy code";const r=document.createElement("div");r.className="code-block-wrapper relative group",t.parentNode&&(t.parentNode.insertBefore(r,t),r.appendChild(t),r.appendChild(e)),e.addEventListener("click",async()=>{const o=t.querySelector("code")?.innerText||t.innerText;try{await navigator.clipboard.writeText(o),e.innerHTML=`
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500">
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
							`,setTimeout(()=>{e.innerHTML=`
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
										<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
									</svg>
								`},2e3)}catch(n){console.error("Failed to copy:",n)}})})});</script>  </body> </html>